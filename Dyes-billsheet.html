<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dyes Bill Sheet</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    .header { text-align: center; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #2a5298; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
    #partySelect { padding: 8px; font-size: 16px; }
  </style>
</head>
<body>
  <div class="header">
    <h2>üé® Dyes Bill Sheet</h2>
    <label for="partySelect">Select Party:</label>
    <select id="partySelect" onchange="filterData()">
      <option value="">-- Choose a party --</option>
    </select>
  </div>

  <div id="tableContainer"></div>

  <script>
    let workbookData = [];
    let parties = [];

    async function loadExcel() {
      try {
        // ‚úÖ Excel file MUST be in the same folder as this HTML
        const response = await fetch("./Factory_Khata_August.xlsx");
        if (!response.ok) throw new Error("Excel file not found");
        const arrayBuffer = await response.arrayBuffer();

        const workbook = XLSX.read(arrayBuffer, { type: "array" });
        const sheetName = workbook.SheetNames[0];
        workbookData = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);

        // collect parties
        parties = [...new Set(workbookData.map(row => row["Party Name"]))].filter(Boolean);

        const partySelect = document.getElementById("partySelect");
        parties.forEach(p => {
          const opt = document.createElement("option");
          opt.value = p;
          opt.textContent = p;
          partySelect.appendChild(opt);
        });
      } catch (err) {
        console.error("Error loading Excel:", err);
        document.getElementById("tableContainer").innerHTML = "<p style='color:red;'>‚ùå Failed to load Excel file</p>";
      }
    }

    function filterData() {
      const party = document.getElementById("partySelect").value;
      if (!party) {
        document.getElementById("tableContainer").innerHTML = "";
        return;
      }

      const filtered = workbookData.filter(row => row["Party Name"] === party);

      if (filtered.length === 0) {
        document.getElementById("tableContainer").innerHTML = "<p>No records found.</p>";
        return;
      }

      let table = "<table><tr>";
      Object.keys(filtered[0]).forEach(key => table += `<th>${key}</th>`);
      table += "</tr>";

      filtered.forEach(row => {
        table += "<tr>";
        Object.values(row).forEach(val => table += `<td>${val ?? ""}</td>`);
        table += "</tr>";
      });

      table += "</table>";
      document.getElementById("tableContainer").innerHTML = table;
    }

    // ‚úÖ only one event listener
    window.addEventListener("DOMContentLoaded", loadExcel);
  </script>
</body>
</html>
